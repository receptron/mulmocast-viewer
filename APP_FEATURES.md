# MulmoCast Viewer - Application Features

このドキュメントは、MulmoCast Viewerアプリケーション（`/src/views/`）の機能と使い方を説明します。

## 目次

- [概要](#概要)
- [ページ構成](#ページ構成)
- [主な機能](#主な機能)
- [URLパラメータ](#urlパラメータ)
- [モバイル対応](#モバイル対応)

## 概要

MulmoCast Viewerアプリケーションは、mulmocast-cliで生成されたコンテンツを閲覧するためのWebアプリケーションです。個別ビート表示とリスト表示の2つのビューを提供します。

## ページ構成

### 1. Viewer（個別ビート表示）

**URL**: `/contents/:contentsId/:page`

個別のビートを1つずつ表示・再生するページです。

#### 機能
- 動画/音声/画像の再生
- 前後のビートへの移動
- 多言語音声・テキストの切り替え
- 再生速度の調整（1x, 1.25x, 1.5x, 1.75x, 2x）
- リストビューへの遷移

#### ヘッダー情報
- ビート番号
- 開始時間（Start）
- 継続時間（Duration）
- 終了時間（End）

### 2. ListView（リスト表示）

**URL**: `/contents/:contentsId/list`

全てのビートを一覧表示するページです。2つの表示モードを切り替えられます。

#### Grid View（グリッド表示）
- サムネイル画像の一覧表示
- 各ビートの番号、開始時間、継続時間を表示
- クリックで個別ビート表示へ遷移（自動再生）

#### List View（全文表示）
- 新聞記事風のレイアウト
- 左側に画像、右側にテキストが回り込むデザイン
- ビート番号と時間情報を画像上部に表示
- 連続音声再生機能

## 主な機能

### 多言語対応

音声言語（Audio）とテキスト言語（Text）を独立して切り替えられます。

- 現在の言語選択がURLパラメータで保存される
- ページ遷移時も言語設定が維持される
- 音声言語とテキスト言語が異なる場合、オリジナル言語のテキストが薄い色で表示される

### Digestモード

**場所**: ListView

重要度（importance）が7以上のビートのみを表示するモードです。

- **Digest**ボタン: 重要なビートのみ表示
- **Show All**ボタン: 全てのビートを表示
- フィルタリング中も連続再生機能が動作

### 連続音声再生（List View）

List Viewで音声を連続再生できます。

#### 操作方法
1. **Play All**ボタンで再生開始
   - 現在表示されているビートから再生開始
   - 自動的に次のビートへ進む
   - 再生中のビートまで自動スクロール

2. **Stop**ボタンで停止

3. **手動スクロール**
   - 再生中にスクロールして停止すると、その位置のビートから再生

#### 再生中の動作
- 現在再生中のビートがURLの`beat`パラメータに反映される
- 画面をスクロールして500ms後、表示位置のビートに切り替わる
- Digestモードでフィルタリングされたビートのみが対象

### 再生速度コントロール

**場所**: Viewer、ListView（List View時）

音声・動画の再生速度を調整できます。

- **1x**: 通常速度
- **1.25x**: 1.25倍速
- **1.5x**: 1.5倍速
- **1.75x**: 1.75倍速
- **2x**: 2倍速

設定は即座に反映され、全てのメディア（動画/音声）に適用されます。

### シームレスナビゲーション

#### Viewer → ListView
- **View List**ボタンをクリック
- 現在のビート位置（`beat`パラメータ）が保持される
- 言語設定も維持される

#### ListView → Viewer
- サムネイルまたはビート番号をクリック
- 自動再生（`autoplay=true`）で開始
- 言語設定が維持される

## URLパラメータ

### 共通パラメータ

| パラメータ | 説明 | 例 |
|-----------|------|-----|
| `audioLang` | 音声言語 | `en`, `ja` |
| `textLang` | テキスト言語 | `en`, `ja` |

### Viewerページ固有

| パラメータ | 説明 | 例 |
|-----------|------|-----|
| `autoplay` | 自動再生 | `true`, `false` |

### ListViewページ固有

| パラメータ | 説明 | 例 |
|-----------|------|-----|
| `beat` | 表示・スクロール位置 | `0`, `5`, `10` |

### URL例

```
# Viewerページ（英語音声、日本語テキスト、自動再生）
/contents/ai/5?audioLang=en&textLang=ja&autoplay=true

# ListViewページ（beat 10から表示、日本語音声・テキスト）
/contents/ai/list?beat=10&audioLang=ja&textLang=ja
```

## モバイル対応

### レスポンシブデザイン

- Tailwind CSSのブレークポイント使用（`sm:`, `lg:`, `xl:`）
- モバイル・タブレット・デスクトップで最適化されたレイアウト

### ListView - モバイル最適化ヘッダー

#### デスクトップ（画面幅 ≥ 640px）
- 全てのコントロールを表示
- タイトル、各種ボタン、言語選択、再生速度選択

#### モバイル（画面幅 < 640px）

**再生停止中**
- タイトル
- Play Allボタン
- Digestボタン

**再生中**
- タイトル非表示
- **Stopボタンのみ**表示
- ヘッダーの高さを最小化してコンテンツ表示領域を最大化

### Grid View

レスポンシブグリッドレイアウト：
- モバイル: 1列
- タブレット: 2列
- デスクトップ（L）: 3列
- デスクトップ（XL）: 4列

### その他のモバイル対応

- `playsinline`属性でiOSでのインライン再生対応
- Page Visibility APIで非アクティブタブでの再生継続
- タップ可能な十分なボタンサイズ

## 技術仕様

### フレームワーク
- Vue 3 (Composition API)
- TypeScript
- Vue Router
- Tailwind CSS

### メディア再生
- HTML5 `<video>` / `<audio>` 要素
- 動画と音声の同期再生
- 複数音声トラック対応
- 言語による動画音量の自動調整

### パフォーマンス
- 次のビートのプリロード
- 画像の遅延読み込み対応準備
- 自動スクロールの最適化（ヘッダー高さ考慮）

## データ形式

### mulmo_view.json

```json
{
  "lang": "en",
  "totalDuration": 4460.785488,
  "totalSegments": 141,
  "beats": [
    {
      "text": "English text",
      "audioSources": {
        "en": "1.mp3",
        "ja": "1_ja.mp3"
      },
      "multiLinguals": {
        "ja": "日本語テキスト",
        "en": "English text"
      },
      "videoSource": "1.mp4",
      "imageSource": "1.jpg",
      "startTime": 0,
      "endTime": 31.809,
      "duration": 31.809,
      "importance": 8
    }
  ]
}
```

### 必須フィールド
- `beats`: ビートの配列

### オプションフィールド（beat毎）
- `text`: デフォルトテキスト
- `multiLinguals`: 多言語テキスト（言語コードをキー）
- `audioSources`: 多言語音声ファイル（言語コードをキー）
- `videoSource`: 動画ファイル（音声なし）
- `videoWithAudioSource`: 音声付き動画ファイル
- `soundEffectSource`: 効果音ファイル
- `imageSource`: 画像ファイル
- `startTime`: 開始時間（秒）
- `endTime`: 終了時間（秒）
- `duration`: 継続時間（秒）
- `importance`: 重要度（数値、Digestモードで使用）

## 開発時の注意点

### 新しいコンテンツの追加

1. `mulmocast-cli`でバンドル生成
2. `public/`ディレクトリ以下に配置
3. `yarn run fileList`でデータリスト更新

### ビルド

```bash
# ライブラリビルド
yarn run build:lib

# アプリケーションビルド
yarn run build:app

# 両方ビルド
yarn run build
```

### 開発サーバー

```bash
yarn run dev
```

## 今後の拡張予定

- [ ] スワイプジェスチャーでのページ移動
- [ ] キーボードショートカット
- [ ] プレイリスト機能
- [ ] ブックマーク機能
- [ ] 検索機能
- [ ] オフライン対応（PWA）
