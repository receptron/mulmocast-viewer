# MulmoCast Viewer

**MulmoCast Viewer** is a Vue 3 component library for playing and displaying bundles (JSON and media files) generated by mulmocast-cli in a browser.

> **Note**: For application-specific features (ListView, Digest mode, mobile optimization, etc.), see [APP_FEATURES.md](./APP_FEATURES.md).

## Installation

```bash
npm install mulmocast-viewer
# or
yarn add mulmocast-viewer
```

## Usage

### Basic Usage

You can easily use the MulmoViewer component in your Vue application.

#### Default UI (with navigation buttons)

```vue
<template>
  <div>
    <MulmoViewer
      :data-set="data"
      :base-path="basePath"
      :audio-lang="audioLang"
      :text-lang="textLang"
    />
    <div>
      Audio: <SelectLanguage v-model="audioLang" />
      Text: <SelectLanguage v-model="textLang" />
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { MulmoViewer, SelectLanguage } from 'mulmocast-viewer'
import 'mulmocast-viewer/style.css'

import data from './path/to/mulmo_view.json'
const basePath = '/media_bundle'
const audioLang = ref('en')
const textLang = ref('en')
</script>
```

#### Custom UI

You can customize navigation buttons and layout using slots.

```vue
<template>
  <MulmoViewer
    :data-set="data"
    :base-path="basePath"
    :audio-lang="audioLang"
    :text-lang="textLang"
    v-slot="{ MulmoPlayer, pageProps, pageMove, currentPage, pageCount }"
  >
    <div class="my-custom-layout">
      <button @click="pageMove(-1)" :disabled="currentPage === 0">
        ← Previous
      </button>

      <component :is="MulmoPlayer" v-bind="pageProps" />

      <button @click="pageMove(1)" :disabled="currentPage >= pageCount - 1">
        Next →
      </button>

      <div class="page-info">
        {{ currentPage + 1 }} / {{ pageCount }}
      </div>
    </div>
  </MulmoViewer>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { MulmoViewer } from 'mulmocast-viewer'
import 'mulmocast-viewer/style.css'

import data from './path/to/mulmo_view.json'
const basePath = '/media_bundle'
const audioLang = ref('en')
const textLang = ref('en')
</script>
```

## Setup Guide

### 1. Create a Bundle with mulmocast-cli

```bash
mulmocast bundle path/to/your/file.json
```

### 2. Place the Generated Folder

Place the generated bundle folder in your project's public directory.

- Vue projects: `/public/media_bundle/`
- Other projects: Any public directory

You can freely change the directory name (e.g., `/public/demo_bundle/`).

### 3. Load JSON Data

Load `mulmo_view.json` using one of the following methods:

#### Method 1: Direct Import

```typescript
import data from './path/to/mulmo_view.json'
```

#### Method 2: Dynamic Loading

```typescript
const response = await fetch('/media_bundle/mulmo_view.json')
const data = await response.json()
```

### 4. Configure basePath

Set `basePath` to the directory or URL where media files are located.

```typescript
// Local path example
const basePath = '/media_bundle'

// External URL example
const basePath = 'https://example.com/bundle_demo'
```

MulmoViewer references media files (images, audio, video) relative to this `basePath`.

## API Reference

### Props

| Prop | Type | Required | Default | Description |
|------|------|----------|---------|-------------|
| `dataSet` | `ViewerData` | Yes | - | Data loaded from mulmo_view.json |
| `basePath` | `string` | Yes | - | Base path for media files (local or URL) |
| `initPage` | `number` | No | `0` | Initial page to display |
| `audioLang` | `string` | No | `'en'` | Audio language |
| `textLang` | `string` | No | `'en'` | Text language |
| `playbackSpeed` | `number` | No | `1` | Playback speed (1, 1.25, 1.5, 1.75, 2) |

### Events

| Event | Parameters | Description |
|-------|------------|-------------|
| `updatedPage` | `nextPage: number` | Emitted when the page is changed |

### Slot Props (for Custom UI)

The default slot exposes the following properties and components:

| Prop | Type | Description |
|------|------|-------------|
| `MulmoPlayer` | `Component` | Player component for displaying media |
| `pageProps` | `Object` | Props to pass to the MulmoPlayer component |
| `currentPage` | `number` | Current page number (0-indexed) |
| `pageCount` | `number` | Total number of pages |
| `pageMove` | `(delta: number) => boolean` | Function to move pages (-1: previous, 1: next) |
| `isPlaying` | `boolean` | Whether media is currently playing |
| `audioLang` | `Ref<string>` | Audio language (mutable) |
| `textLang` | `Ref<string>` | Text language (mutable) |
| `SelectLanguage` | `Component` | Language selection component |

## For Developers

This repository provides a development environment for the viewer component.

### Development Environment Setup

1. **Create a Bundle**

```bash
mulmocast bundle scripts/foo/bar.json
```

2. **Place the Generated Folder**

Place the bundle folder under `public/`. Ensure the path looks like this:

```
public/bar/mulmo_view.json
```

3. **Update Data List**

```bash
yarn run fileList
```

4. **Start Development Server**

```bash
yarn run dev
```

### Build

```bash
# Library build
yarn run build:lib

# Application build
yarn run build:app

# Build both
yarn run build
```

## License

MIT
